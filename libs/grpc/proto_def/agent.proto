syntax = "proto3";

package agent;

message CommandResponse {
  oneof payload {
    AgentInfo agent_info = 1;
    ProcessInfo process_info = 2;
    CronJobs cron_jobs = 3;
    FirewallStatus firewall_status = 4;
    ReturnInfo return_info = 5;
    RawResponse raw = 6;
    NetworkInterfaces network_interfaces = 7;
    RouteTable route_table = 8;
    DnsInfo dns_info = 9;
    ParentDirectory parent_directory = 10;
    SoftwareInventory software_inventory = 11;
    Logs logs = 12;
    ApacheInfo apache_info = 13;
    ServerHostInfo server_host_info = 14;
  }
}

enum AgentCommand {
  AGENT_COMMAND_UNSPECIFIED = 0;
  AGENT_COMMAND_GET_PROCESS = 1;
  AGENT_COMMAND_GET_CRON = 2;
  AGENT_COMMAND_GET_FIREWALL = 3;
  AGENT_COMMAND_GET_NETIF = 4;
  AGENT_COMMAND_GET_ROUTE = 5;
  AGENT_COMMAND_GET_DNS = 6;
  AGENT_COMMAND_GET_PDIR = 7;
  AGENT_COMMAND_GET_SOFTWARE = 8;
  AGENT_COMMAND_GET_LOG = 9;
  AGENT_COMMAND_GET_LOG_QUERY = 10;
  AGENT_COMMAND_SOFTWARE_INSTALL = 11;
  AGENT_COMMAND_SOFTWARE_DELETE = 12;
  AGENT_COMMAND_PROCESS_START = 13;
  AGENT_COMMAND_PROCESS_STOP = 14;
  AGENT_COMMAND_PROCESS_RESTART = 15;
  AGENT_COMMAND_PROCESS_ENABLE = 16;
  AGENT_COMMAND_PROCESS_DISABLE = 17;
  AGENT_COMMAND_PROCESS_START_ENABLE = 18;
  AGENT_COMMAND_PROCESS_STOP_DISABLE = 19;
  AGENT_COMMAND_CRON_ADD = 20;
  AGENT_COMMAND_CRON_DELETE = 21;
  AGENT_COMMAND_CRON_UPDATE = 22;
  AGENT_COMMAND_FIREWALL_ADD = 23;
  AGENT_COMMAND_FIREWALL_DELETE = 24;
  AGENT_COMMAND_FIREWALL_EDIT_STATUS = 25;
  AGENT_COMMAND_FIREWALL_EDIT_POLICY = 26;
  AGENT_COMMAND_NETIF_ADD = 27;
  AGENT_COMMAND_NETIF_DELETE = 28;
  AGENT_COMMAND_NETIF_UP = 29;
  AGENT_COMMAND_NETIF_DOWN = 30;
  AGENT_COMMAND_ROUTE_ADD = 31;
  AGENT_COMMAND_ROUTE_DELETE = 32;
  AGENT_COMMAND_REBOOT = 33;
  AGENT_COMMAND_SHUTDOWN = 34;
  AGENT_COMMAND_GET_INFO = 35;
  AGENT_COMMAND_GET_SERVER_APACHE = 36;
  AGENT_COMMAND_SERVER_APACHE_START = 37;
  AGENT_COMMAND_SERVER_APACHE_STOP = 38;
  AGENT_COMMAND_SERVER_APACHE_RESTART = 39;
  AGENT_COMMAND_GET_SERVER_INSTALL = 40;
  AGENT_COMMAND_GET_SERVER_NONINSTALL = 41;
}

message CommandRequest {
  AgentCommand command = 1;
  optional string argument = 2;
}

service AgentService {
  rpc ExecuteCommand(CommandRequest) returns (CommandResponse);
}

service AgentInfoService {
  rpc GetInfo(GetInfoRequest) returns (AgentInfo);
}

message GetInfoRequest {}

message FileUploadRequest {
  string path = 1;
  string file = 2;
}

message FileDownloadRequest {
  string path = 1;
  string filename = 2;
}

message FileDownloadResponse {
  oneof result {
    string file = 1;
    ReturnInfo return_info = 2;
  }
}

service AgentFileService {
  rpc FilePdirUpload(FileUploadRequest) returns (ReturnInfo);
  rpc FilePdirDownload(FileDownloadRequest) returns (FileDownloadResponse);
}

message AgentInfo {
  float cpu = 1;
  float mem = 2;
  float disk = 3;
}

message ProcessStatus {
  bool status = 1;
  bool boot = 2;
}

message ProcessEntry {
  string name = 1;
  ProcessStatus status = 2;
}

message ProcessInfo {
  repeated ProcessEntry entries = 1;
  uint32 length = 2;
}

message CronSchedule {
  int32 minute = 1;
  int32 hour = 2;
  int32 date = 3;
  int32 month = 4;
  int32 week = 5;
}

message CronJob {
  string id = 1;
  string name = 2;
  string command = 3;
  CronSchedule schedule = 4;
  string username = 5;
}

message CronJobs {
  repeated CronJob jobs = 1;
  uint32 length = 2;
}

message ReturnInfo {
  string type = 1;
  string message = 2;
}

message RawResponse {
  string data = 1;
}

message FirewallRule {
  string id = 1;
  string target = 2;
  string protocol = 3;
  string in = 4;
  string out = 5;
  string source = 6;
  string destination = 7;
  string options = 8;
}

message FirewallChain {
  string name = 1;
  string policy = 2;
  repeated FirewallRule rules = 3;
  uint32 rules_length = 4;
}

message FirewallStatus {
  string status = 1;
  repeated FirewallChain chains = 2;
}

message NetworkInterface {
  string id = 1;
  string type = 2;
  string ipv4 = 3;
  string netmask = 4;
  string mac = 5;
  string broadcast = 6;
  uint32 mtu = 7;
  string status = 8;
}

message NetworkInterfaces {
  repeated NetworkInterface interfaces = 1;
  uint32 length = 2;
}

enum DirectorySizeUnit {
  DIRECTORY_SIZE_UNSPECIFIED = 0;
  B = 1;
  KB = 2;
  MB = 3;
  GB = 4;
}

message DirectoryEntry {
  double size = 1;
  DirectorySizeUnit unit = 2;
  string owner = 3;
  string mode = 4;
  string modified = 5;
}

message ParentDirectory {
  map<string, DirectoryEntry> files = 1;
  uint32 length = 2;
}

enum PackageStatus {
  PACKAGE_STATUS_UNSPECIFIED = 0;
  INSTALLED = 1;
  NOTINSTALL = 2;
}

message SoftwarePackage {
  string version = 1;
  PackageStatus status = 2;
}

message SoftwareInventory {
  map<string, SoftwarePackage> packages = 1;
}

message LogEntry {
  string month = 1;
  int32 day = 2;
  string time = 3;
  string hostname = 4;
  string type = 5;
  string messages = 6;
}

message Logs {
  map<string, LogEntry> logs = 1;
  uint32 length = 2;
}

enum ApacheStatus {
  APACHE_STATUS_UNSPECIFIED = 0;
  APACHE_STATUS_ACTIVE = 1;
  APACHE_STATUS_STOPPED = 2;
}

enum ApacheLogLevel {
  APACHE_LOG_LEVEL_UNSPECIFIED = 0;
  APACHE_LOG_LEVEL_DEBUG = 1;
  APACHE_LOG_LEVEL_INFO = 2;
  APACHE_LOG_LEVEL_NOTICE = 3;
  APACHE_LOG_LEVEL_WARN = 4;
  APACHE_LOG_LEVEL_ERROR = 5;
  APACHE_LOG_LEVEL_CRIT = 6;
  APACHE_LOG_LEVEL_ALERT = 7;
  APACHE_LOG_LEVEL_EMERG = 8;
}

enum ApacheWeek {
  APACHE_WEEK_UNSPECIFIED = 0;
  APACHE_WEEK_MON = 1;
  APACHE_WEEK_TUE = 2;
  APACHE_WEEK_WED = 3;
  APACHE_WEEK_THU = 4;
  APACHE_WEEK_FRI = 5;
  APACHE_WEEK_SAT = 6;
  APACHE_WEEK_SUN = 7;
}

enum ApacheMonth {
  APACHE_MONTH_UNSPECIFIED = 0;
  APACHE_MONTH_JAN = 1;
  APACHE_MONTH_FEB = 2;
  APACHE_MONTH_MAR = 3;
  APACHE_MONTH_APR = 4;
  APACHE_MONTH_MAY = 5;
  APACHE_MONTH_JUN = 6;
  APACHE_MONTH_JUL = 7;
  APACHE_MONTH_AUG = 8;
  APACHE_MONTH_SEP = 9;
  APACHE_MONTH_OCT = 10;
  APACHE_MONTH_NOV = 11;
  APACHE_MONTH_DEC = 12;
}

message ApacheDate {
  int32 year = 1;
  ApacheMonth month = 2;
  int32 day = 3;
  ApacheWeek week = 4;
  message Time {
    uint32 hour = 1;  // Hour
    uint32 min = 2;   // Min
  }
  Time time = 5;
}

message ApacheErrorLog {
  ApacheDate date = 1;
  string module = 2;
  ApacheLogLevel level = 3;
  uint64 pid = 4;
  string client = 5;
  string message = 6;
}

message ApacheAccessLog {
  string ip = 1;
  ApacheDate date = 2;
  string method = 3;
  string url = 4;
  string protocol = 5;
  int64 status = 6;
  int64 byte = 7;
  string referer = 8;
  string user_agent = 9;
}

message ApacheLogs {
  repeated ApacheErrorLog error_log = 1;
  uint64 errlength = 2;
  repeated ApacheAccessLog access_log = 3;
  uint64 acclength = 4;
}

message ApacheInfo {
  string hostname = 1;
  ApacheStatus status = 2;
  double cpu = 3;
  double memory = 4;
  int64 connections = 5;
  string ip = 6;
  ApacheLogs logs = 7;
}

message ServerHostInfo {
  enum Status {
    SERVER_STATUS_UNSPECIFIED = 0;
    ACTIVE = 1;
    STOPPED = 2;
  }
  string hostname = 1;
  Status status = 2;
  double cpu = 3;
  double memory = 4;
  string ip = 5;
}

message RouteEntry {
  string destination = 1;
  string via = 2;
  string dev = 3;
  string proto = 4;
  int32 metric = 5;
  string scope = 6;
  string src = 7;
}

message RouteTable {
  map<string, RouteEntry> routes = 1;
  uint32 length = 2;
}

message DnsInfo {
  string hostname = 1;
  string primary = 2;
  string secondary = 3;
}
